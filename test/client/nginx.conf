worker_processes  1;
error_log /dev/stdout info;
daemon off;

events {
  worker_connections 1024;
}

http {
  access_log /dev/stdout;
  lua_package_path "/usr/local/Cellar/lua51/5.1.5_4/share/lua/5.1/resty/?.lua;;";
  server {
    listen 4001;
    location / {
      content_by_lua_block {
        local http = require "resty.http"
        local httpc = http.new()
        local uri = (ngx.var.host .. ngx.var.uri)
        local res, err = httpc:request_uri("http://127.0.0.1:4000/api/match?path=" .. uri)
        ngx.say(res.body)
      }
    }
  }
}
